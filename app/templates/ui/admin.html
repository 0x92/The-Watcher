{% extends 'base.html' %}
{% block content %}
<section class="page-header">
  <h1>Administration</h1>
  <p>Steuere die Hintergrund-Worker und verwalte News-Quellen.</p>
</section>

<div class="admin-grid">
  <section class="card admin-card" data-admin-worker-overview>
    <div class="admin-card__header">
      <div>
        <h2>Worker-Status</h2>
        <p class="lead">Überblick über aktive Hintergrundprozesse und laufende Tasks.</p>
      </div>
      <div class="admin-card__header-actions">
        <button type="button" class="button" data-worker-refresh>Aktualisieren</button>
        <span class="admin-card__meta" data-worker-updated>Stand: –</span>
      </div>
    </div>
    <p class="status-message" data-worker-overview-status hidden></p>
    <div class="workers-list" data-workers-list>
      <p class="workers-empty">Noch keine Worker registriert.</p>
    </div>
  </section>

  <section class="card admin-card" data-admin-worker>
    <h2>Worker-Einstellungen</h2>
    <p class="status-message" data-worker-status hidden></p>
    <form class="admin-form" data-worker-form>
      <label class="form-control" for="scrape-enabled">
        <span>Automatisches Scrapen aktivieren</span>
        <input type="checkbox" id="scrape-enabled" name="scrape_enabled" />
      </label>
      <label class="form-control" for="default-interval">
        <span>Standardintervall (Minuten)</span>
        <input
          type="number"
          id="default-interval"
          name="default_interval_minutes"
          min="1"
          step="1"
          required
        />
      </label>
      <label class="form-control" for="max-sources">
        <span>Max. Quellen pro Durchlauf (0 = unbegrenzt)</span>
        <input
          type="number"
          id="max-sources"
          name="max_sources_per_cycle"
          min="0"
          step="1"
          required
        />
      </label>
      <button type="submit" class="button primary">Speichern</button>
    </form>
  </section>

  <section class="card admin-card" data-admin-gematria>
    <div class="admin-card__header">
      <div>
        <h2>Gematria-Konfiguration</h2>
        <p class="lead">
          Lege fest, welche Ciphers berechnet werden und welche Zeichen berücksichtigt sind.
        </p>
      </div>
      <div class="admin-card__header-actions">
        <button type="button" class="button subtle" data-gematria-select-all>
          Alle aktivieren
        </button>
        <button type="button" class="button subtle" data-gematria-reset>
          Zurücksetzen
        </button>
      </div>
    </div>
    <p class="status-message" data-gematria-status hidden></p>
    <form class="admin-form" data-gematria-form>
      <fieldset class="scheme-grid" data-gematria-list>
        <legend class="visually-hidden">Verfügbare Gematria-Ciphers</legend>
      </fieldset>
      <label class="form-control" for="gematria-ignore">
        <span>Regex für erlaubte Zeichen (Leer lassen für Standard)</span>
        <input
          type="text"
          id="gematria-ignore"
          name="ignore_pattern"
          placeholder="[^A-Z]"
          autocomplete="off"
        />
      </label>
      <div class="form-actions">
        <button type="submit" class="button primary">Speichern</button>
      </div>
    </form>
  </section>

  <section class="card admin-card" data-admin-sources>
    <div class="admin-card__header">
      <div>
        <h2>Quellen &amp; RSS</h2>
        <p class="lead">Verwalte Feeds, filtere nach Typen und behalte den Überblick über neue Artikel.</p>
      </div>
      <div class="admin-card__header-actions">
        <button type="button" class="button" data-source-refresh>Aktualisieren</button>
      </div>
    </div>
    <p class="status-message" data-source-status hidden></p>

    <div class="source-overview">
      <form class="source-filters" data-source-filter-form>
        <label class="form-control" for="source-query">
          <span>Suche</span>
          <input type="search" id="source-query" name="query" placeholder="Name oder URL" />
        </label>
        <label class="form-control" for="source-filter-type">
          <span>Typ</span>
          <select id="source-filter-type" name="type">
            <option value="all">Alle Typen</option>
            <option value="rss">RSS</option>
            <option value="atom">Atom</option>
          </select>
        </label>
        <label class="form-control" for="source-filter-status">
          <span>Status</span>
          <select id="source-filter-status" name="status">
            <option value="all">Alle</option>
            <option value="active">Aktiv</option>
            <option value="inactive">Deaktiviert</option>
          </select>
        </label>
        <div class="form-actions">
          <button type="submit" class="button">Filter anwenden</button>
          <button type="button" class="button" data-source-filter-reset>Zurücksetzen</button>
        </div>
      </form>

      <div class="stat-grid" data-source-stats>
        <article class="stat-card">
          <h3>Gesamtquellen</h3>
          <p class="stat-card__value">–</p>
          <p class="stat-card__meta">Keine Daten</p>
        </article>
        <article class="stat-card">
          <h3>Gesamt-Items</h3>
          <p class="stat-card__value">–</p>
          <p class="stat-card__meta">Keine Daten</p>
        </article>
        <article class="stat-card stat-card--types">
          <h3>Quellen-Typen</h3>
          <p class="stat-card__meta">Keine Daten</p>
        </article>
      </div>
    </div>

    <form class="admin-form" data-source-form>
      <div class="form-row">
        <label class="form-control" for="source-name">
          <span>Name</span>
          <input type="text" id="source-name" name="name" required />
        </label>
        <label class="form-control" for="source-type">
          <span>Typ</span>
          <select id="source-type" name="type">
            <option value="rss">RSS</option>
            <option value="atom">Atom</option>
          </select>
        </label>
        <label class="form-control" for="source-interval">
          <span>Intervall (Minuten)</span>
          <input
            type="number"
            id="source-interval"
            name="interval_minutes"
            min="0"
            step="1"
          />
        </label>
      </div>
      <label class="form-control" for="source-endpoint">
        <span>Feed URL</span>
        <input type="url" id="source-endpoint" name="endpoint" required />
      </label>
      <div class="form-actions">
        <label class="inline-control" for="source-enabled">
          <input type="checkbox" id="source-enabled" name="enabled" checked />
          <span>Quelle direkt aktivieren</span>
        </label>
        <button type="submit" class="button">Quelle hinzufügen</button>
      </div>
    </form>

    <div class="sources-list" data-sources-list aria-live="polite"></div>
  </section>
</div>
{% endblock %}
